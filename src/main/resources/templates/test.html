<!DOCTYPE html>
<html lang="en" xmlns:zoom="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>深圳市xxx有限公司</title>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="js/materialize.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/tooplate.css">
    <script src="js/zoomify.min.js" type="text/javascript"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="js/rolldate.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/zoomify.min.css">
    <script src="bootstrap-3.3.7/js/bootstrap.js" type="text/javascript"></script>
    <script src='//player.polyv.net/script/polyvplayer.min.js'></script>
    <link rel="icon" type="image/x-icon" href="../static/favicon/favicon.ico">
    <link rel="stylesheet" href="css/icon/iconfont.css">


    <script src="js/base64image.js" type="text/javascript"></script>
    <script src="js/exif.js" type="text/javascript"></script>
    <script src="js/lrz.bundle.js"></script>
    <style type="text/css">
        #show-company-data{
            position: absolute;
            z-index: 1;
            height: 200px;
            left: 50%;
        }
        .my-modal{
            display: block;
            z-index: 2;
            right: 0;
            background-color: #fafafa;
            max-height: 70%;
            overflow-y: auto;
            border-radius: 2px;
            width:auto;
            position:absolute;
            left:0;
            top:60%;
            margin:-1px 0 0 -150px
        }
        .my-modal-head{
            color: black;
            height: 50px;
        }
        .my-modal-content{
            padding-left: 10px;
            padding-right: 10px;
            line-height: 25px;
        }
        .my-modal-footer{
            height: 60px;
            line-height: 55px;
        }
        .icon-close{
            font-size: 25px;
            float: right;
            margin: 9px;
        }
        p{
            line-height: 15px;
        }
    </style>
</head>

<body id="application">

<div class="container">
    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12  mx-auto">
            <div class="my-modal col-xl-12 col-lg-12 col-md-12 col-sm-12  mx-auto" id="my-modals" style="display: none">
                <div class="my-modal-head">
                    <span class="iconfont icon-close" id="close-modal"></span>
                </div>
                <div class="my-modal-content">
                    <p style="font-size: 22px">
                        报名失败
                    </p>
                    <p>原因：贵公司的报名人数已满6人限额</p>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>公司名称</th>
                            <th>姓名</th>
                        </tr>
                        </thead>
                        <tbody id="show-data">
                        </tbody>
                    </table>
                    <div>如您对上面名单有疑问，请公众号后台留言，或电话0755-26583671</div>
                </div>
                <div class="my-modal-footer center">
                    <button type="button" id="closeButten1" class="btn btn-success ">确认</button>
                </div>
            </div>


            <div class="my-modal col-xl-12 col-lg-12 col-md-12 col-sm-12  mx-auto" id="my-modals2" style="display: none">
                <div class="my-modal-head">
                    <span class="iconfont icon-close" id="close-modal2"></span>
                </div>
                <div class="my-modal-content">
                    <p style="font-size: 22px">
                        报名已提交
                    </p>
                    <p>工作人员会尽快联系你,请保持电话畅通</p>
                    <p>贵公司已报名单为：</p>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>公司名称</th>
                            <th>姓名</th>
                        </tr>
                        </thead>
                        <tbody id="show-data2">
                        </tbody>
                    </table>
                    <div>如您对上面名单有疑问，请公众号后台留言，或电话0755-26583671</div>

                </div>
                <div class="my-modal-footer center">
                    <button type="button" id="closeButten2" class="btn btn-success ">确认</button>
                </div>
            </div>
            <header class="mt-5 mb-5 text-center">
                <p style="font-size: 22px"><strong>深圳市xxx科技有限公司</strong></p>
                <img style="height: 50px;width: 100px" src="img/hrt.jpg">

            </header>
            <form id="form" enctype="multipart/form-data" class="tm-form-white tm-font-big">
                <div class="tm-bg-white tm-form-pad-big">
                    <div class="form-group mb-2">
                        <label for="company" class="black-text mb-4 big">公司名称(全称)：</label>
                        <input id="company" name="company" type="text" class="validate tm-input-white-bg">
                    </div>
                    <div class="form-group mb-2">
                        <label for="name" class="black-text mb-4 big">姓名：</label>
                        <input id="name" name="name" type="text" class="validate tm-input-white-bg">
                    </div>
                    <div class="form-group mb-2">
                        <label for="phone" class="black-text mb-4 big">手机号码：</label>
                        <input id="phone" name="phone" type="text" maxlength="11" minlength="11"
                               class="validate tm-input-white-bg mb-4">
                    </div>

                    <div class="form-group mb-2">
                        <label for="address" class="black-text mb-4 big">收货地址(仅限公司地址)：</label>
                        <input id="address" name="address" type="text" class="validate tm-input-white-bg mb-4">
                    </div>
                    <div class="form-group mb-2">
                        <label for="fahuo" class="black-text mb-4 big">期待礼品发货时间：</label>
                        <input id="fahuo" name="fahuo" type="text" class="validate tm-input-white-bg">
                    </div>
                    <div class="form-group mb-4">
                        <label class="black-text mb-4 big">类别：</label>
                        <div>
                            <label class="mr-4" id="isHrt1">
                                <input class="with-gap" name="isHrt" type="radio" value="0"/>
                                <span>xxx用户</span>
                            </label>
                            <label id="isHrt2">
                                <input class="with-gap" name="isHrt" type="radio" value="1"/>
                                <span>线束智造读者</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group mb-4" id="prize">
                    </div>
                </div>
                <div class="text-center mt-5">
                    <button type="button" id="agree" class="waves-effect btn-large btn-large-white">提交</button>
                </div>
                <div id="show-company-data">
                    <ul class="list-group" id="show-company-list">
                    </ul>
                </div>
            </form>
        </div>
    </div>
    <footer class="row tm-mt-big mb-3">
        <div class="col-xl-12 text-center">
            <p class="d-inline-block tm-bg-black white-text py-2 tm-px-5">
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
            </p>
        </div>
    </footer>
</div>

<script>
    $(function () {
        $('.zoomify').zoomify();
    });
    window.onload = function () {
        new Rolldate({
            el: '#fahuo',
            format: 'YYYY-MM-DD',
            beginYear: 2000,
            endYear: 2100
        })
    }


    var fileUp = function (me) {
        base64Image({
            width: 300,                             /*【选填】宽度默认750，如果图片尺寸大于该宽度，图片将被设置为该宽度*/
            ratio: 0.05,                            /*【选填】压缩率默认0.75 */
            file: me,                              /*【必填】对应的上传元素 */
            callback: function (imageUrl) {        /*【必填】处理成功后的回调函数 */
                /*imageUrl为得到的图片base64数据，这里可以进行上传到服务器或者其他逻辑操作 */
                var img = new Image();
                img.src = imageUrl;
                $("#pic").attr("style", "display:block;");//显示div
                $('#image-list').attr('src', imageUrl); //显示预览图片
            },
        });
    };

    //往div中添加的元素
    var appendList =[]
    $(document).ready(function () {

        //点击X 关闭数据展示
        $("#close-modal").click(function(){
            $("#my-modals").attr("style", "display:none;");
            window.location.href = "http://www.xxx.com/";
        });

        $("#closeButten1").click(function(){
            $("#my-modals").attr("style", "display:none;");
            window.location.href = "http://www.xxx.com/";
        });

        $("#closeButten2").click(function(){
            $("#my-modals").attr("style", "display:none;");
            window.location.href = "http://www.xxx.com/";
        });

        $("#close-modal2").click(function(){
            $("#my-modals").attr("style", "display:none;");
            window.location.href = "http://www.xxx.com/";
        });

        $('#company').bind('input', function () {//给文本框绑定input事件
            var company = $("#company").val();
            if (company==="" || company === undefined){
                return;
            }
            var top = ($("#company").offset().top+$("#company").height()+10)+"px"
            var left = "-"+$("#company").width()/2+"px"
            var width = $("#company").width()+"px"
            if(company.length > 5 ){
                $.ajax({
                    url: "/checkCompany",
                    type: "get",
                    data: {"company": company},
                    success: function (data) {
                        var obj = JSON.parse(data);
                        if (obj["Status"] == 200) {
                            var showComData = $("#show-company-data")
                            showComData.css("display","block")
                            showComData.css("top",top)
                            showComData.css("margin-left",left)
                            showComData.css("width",width)
                            var result = obj["Result"]
                            var showlist =  $("#show-company-list")
                            for(var i=0;i <appendList.length;i++){
                                appendList[i].remove()
                            }
                            for (var i = 0; i < result.length; i++) {
                                var Odata = result[i]
                                $li = $("<li class=\"list-group-item   show-com-data-item\">"+Odata["Name"]+"</li>")
                                showlist.append($li)
                                //装在添加的集合中
                                appendList.push($li)
                            }
                            var lis = $(".show-com-data-item")
                            for (var i = 0; i < lis.length; i++){
                                (
                                    function (i) {
                                        lis[i].onclick = function () {
                                            var text = lis[i].innerText
                                            $("#company").val(text)
                                            $("#show-company-data").css("display","none")
                                        }
                                    }
                                )(i)
                            }
                        }else if (obj["Status"] == 201){
                            $("#company").val("");
                            alert("公司名输入有误，请重新查证后再试")
                        }
                    },
                    error: function (e) {
                        alert("服务器异常")
                    }
                });
            }

        });

        //当公司名称输入小于6字符时候 对下面的文本块进行禁用
        $("#company").blur(function(){
            var company = $("#company").val();
            console.log(company.length)
            if (company.length <6 ){
                console.log()
                $("#name").attr('disabled', 'disabled')
                $("#phone").attr('disabled', 'disabled')
                $("#address").attr('disabled', 'disabled')
                $("#isHrt").attr('disabled', 'disabled')
                $("#fahuo").attr('disabled', 'disabled')
            }else {
                $("#name").removeAttr('disabled');
                $("#phone").removeAttr('disabled');
                $("#address").removeAttr('disabled');
                $("#isHrt").removeAttr('disabled');
                $("#fahuo").removeAttr('disabled');
            }
        });

        $('select').formSelect();
        $("#agree").click(function () {
            var company = $("#company").val();
            var name = $("#name").val();
            var phone = $("#phone").val();
            var address = $("#address").val();
            var isHrt = $('input[name=isHrt]:checked').val();
            var fahuo = $('#fahuo').val();

            // 验证手机号
            function isPhoneNo(phone) {
                var pattern = /^1[345789]\d{9}$/;
                return pattern.test(phone);
            }
            //var imageList = $("#image-list")[0].src;
            if (company == "" || company == null) {
                alert("请输入公司名")
                return false;
            } else if (name == "" || name == null) {
                alert("请输入姓名")
                return false;
            } else if (phone == "" || phone.length == 0) {
                alert("请输入电话号码")
                return false;
            } else if (isPhoneNo(phone) == false) {
                alert("请输入正确的电话号码")
                return false;
            } else if (address == "" || address == null) {
                alert("请输入地址")
                return false;
            } else if (isHrt == "" || isHrt == null) {
                alert("请选择类别")
                return false;
            } else if (fahuo == null || fahuo == "") {
                alert("请填写期待礼品发货时间")
                return false;
            }
            //数据
            var data = {
                company: company,
                name: name,
                phone: phone,
                address: address,
                hrt: isHrt,
                fahuo:fahuo
            };
            $('#agree').attr("disabled", true);
            Submission(data);
        })
        var appendLists =[]
        var appendLists2 =[]
        //提交的方法
        function Submission(datavalue) {
            $('#agree').attr("disabled", true);
            $.ajax({
                url: "/addUserInfo",
                type: "post",
                data: datavalue,
                success: function (data) {
                    if (200 == data.status) {
                        console.log(data);
                        //展示数据 公司名和姓名
                        $("#my-modals2").attr("style", "display:block;");//显示div
                        var result = data.data;
                        var showlist =  $("#show-data2")
                        for(var i=0;i <appendLists.length;i++){
                            appendLists2[i].remove()
                        }
                        for(var i= 0 ; i<result.length;i++){
                            var Odata = result[i]
                            $li = $("<tr><td >"+Odata["company"]+"</td>" +
                                "<td >"+Odata["name"]+"</td></tr>")
                            showlist.append($li)
                            //装在添加的集合中
                            appendLists2.push($li)
                        }
                        $('#myModal').modal('show')

                    } else if (401 == data.status) {
                        $("#my-modals").attr("style", "display:block;");//显示div
                        var result = data.data;
                        var showlist =  $("#show-data")
                        for(var i=0;i <appendLists.length;i++){
                            appendLists[i].remove()
                        }
                        //满6个展示 公司名和姓名
                        for(var i= 0 ; i<result.length;i++){
                            var Odata = result[i]
                            $li = $("<tr><td >"+Odata["company"]+"</td>" +
                                "<td >"+Odata["name"]+"</td></tr>")
                            showlist.append($li)
                            //装在添加的集合中
                            appendLists.push($li)
                        }
                        $('#myModal').modal('show')
                        //window.location.href = "http://www.xxx.com/";
                    } else if (402 == data.status) {
                        window.location.href = "/";
                    } else if (403 == data.status) {
                        alert("你已提交过了，请勿重复提交");
                        window.location.href = "/";
                    }
                },
                error: function (e) {
                    alert("服务器异常")
                }
            });
            $('#agree').attr("disabled", false);
        }
    })





</script>
</body>

</html>